---
title             : "Children’s interpretation of ambiguous pronouns based on prior discourse"
shorttitle        : "Discourse inferences in early childhood"

author: 
  - name          : "Manuel Bohn"
    affiliation   : "1,2"
    corresponding : yes    # Define only one corresponding author
    address       : "Jahnallee 59, 04109 Leipzig, Germany"
    email         : "manuel.bohn@uni-leipzig.de"
  - name          : "Khuyen Nha Le"
    affiliation   : "1"
  - name          : "Benjamin Peloquin"
    affiliation   : "1"
  - name          : "Bahar Köymen"
    affiliation   : "3"
  - name          : "Michael C. Frank"
    affiliation   : "1"            

affiliation:
  - id            : "1"
    institution   : "Department of Psychology, Stanford University"
  - id            : "2"
    institution   : "Leipzig Research Center for Early Child Development, Leipzig University"
  - id            : "3"
    institution   : "School of Health Sciences, University of Manchester"

authornote: |
  We thank Megan Merrick and Sabina Zacco for their help with the data collection and all families for participating. Manuel Bohn received funding from the European Union’s Horizon 2020 research and innovation programme under the Marie Sklodowska-Curie grant agreement no. 749229. 

abstract: |
  In conversation, speech is almost always ambiguous, with this ambiguity resolved by context and discourse history (“common ground”). One important cue for disambiguation is the topic under discussion with a particular partner (e.g., “want to pick?” means something different in a conversation with a bluegrass musician vs. with a book club partner). Here, we investigated 2- to 5-year-old American English-speaking children’s (N = 131) reliance on conversational topics with specific partners to interpret ambiguous or novel words. Children heard a speaker consistently refer to objects from a category without mentioning the category itself. In Study 1, 3- and 4-year-olds interpreted the ambiguous pronoun it as referring to another member of the same category. In study 2, 4-year-olds only interpreted the pronoun as referring to the implied category when talking to the same speaker but not when talking to a new speaker. Thus, children’s conception of what constitutes common ground in discourse develops substantially between age 2 and 5. 
  
keywords          : "Discourse, Pragmatics, Social cognition, Language development, Conceptual development"

bibliography      : ["library.bib"]

floatsintext      : yes
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library(papaja)
library(tidyverse)
library(ggplot2)
library(brms)
library(ggthemes)
library(langcog)
library(ggpubr)
library(BayesFactor)
library(broom)
library(coda)
library(reshape2)
library(ggridges)

estimate_mode <- function(s) {
  d <- density(s)
  return(d$x[which.max(d$y)])
}

hdi_upper<- function(s){
  m <- HPDinterval(mcmc(s))
  return(m["var1","upper"])
}

hdi_lower<- function(s){
  m <- HPDinterval(mcmc(s))
  return(m["var1","lower"])
}
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
knitr::opts_chunk$set(echo = F, warning = F, message = F)
```

```{r load data}
ex1_data <- read_csv(file="../data/data_ex1.csv")
ex2_data <- read_csv(file="../data/data_ex2.csv")
```
# Research highlights

* Conversational topics organize discourse with specific partners
* Children make inferences about conversational topics from 3 years onwards
* From 4 years onwards, children see conversational topics as speaker specific
* Discourse structures communicative interactions and thereby helps children to resolve ambiguity and learn language


# Introduction

Language learning and use is a fundamentally social behavior -- when children hear ambiguous or novel words they can rely on social information to infer meaning [e.g. @bohn2019pervasive; @tomasello2008origins; @clark2009first]. As discourse unfolds, interlocutors build up common ground - a set of shared knowledge and beliefs - that serves as a background against which new utterances are interpreted [@bohn2018common; @clark1996using]. To use common ground in this way, children not only have to pay attention to what is said earlier but also with whom they have had this conversation and share this common ground. 
Children as young as 18 months old can use information from prior discourse to disambiguate words. Children typically interpret an ambiguous pronoun as referring to a previously mentioned object - even when it was absent from the scene [@ganea2007infants; @lidz2003infants]. This behavior diversifies with age - 3 to 5-year olds use discourse context to interpret personal pronouns [@song2005s; @hartshorne2015development].

Children can also rely on prior discourse to learn new words. For instance, when a speaker first states that they were hungry and then asks for a wug, 2-year-olds map the novel word onto an edible object [@sullivan2016discourse] Around age 3, children see the positioning of a novel word in discourse as a clue to its meaning [@horowitz2015young]. And starting at age 4, children use discourse coherence - as expressed by connectives such as and or because - to interpret the meaning of a novel word [@sullivan2019discourse]. Beyond nouns, children can also infer some aspects of verb meaning based on discourse context [@yuan2009really; @fisher2020developmental].

In almost all of these studies, the loose construct of “discourse” or “common ground” is operationalized as including the specific objects that had been explicitly mentioned. In conversation, however, discourse is often organized in terms of an overarching topic rather than a specific object. Further, this topic is rarely stated explicitly; instead it is typically inferred based on the content of utterances [@clark1996using]. For example, when a child reports from a school trip “I saw an elephant, a tiger, a giraffe, and another one that was really scary” the parent can infer that another one refers to yet another animal. 
One study comes closer to this conception of discourse topic. Akhtar [-@akhtar2002relevance] had children interact with an adult who repeatedly drew their attention to either the shape or the color of an object. When the adult later used a novel word to describe an object, children mapped the word on the property (color or shape) that was focused on during the preceding discourse. Children could solve this task by keeping track of which part of the objects they were jointly attending to (in the sense of looking at) with the speaker previously. Such visual anchoring, however, is not always possible because the topic may be absent and/or an abstract entity (such as “animals” in the example above). In this scenario the topic has to be inferred by reasoning about how the individual conversational bits relate to one another - how they are organized in conceptual terms.

Another neglected aspect of discourse inference, at least in experimental work, is its social nature. Put differently, common ground built up during discourse is often partner-specific. Subsequent inferences therefore incorporate both the conversational topic(s), but crucially also social information - the participants engaging in the conversation. Children keep track of their conversational partners from a very young age [@bohn2018social]. Saylor and Ganea [-@saylor2007infants] had 14 to 20 month old children play ball with two different experimenters. Depending on who later asked for “the ball”, children retrieved the object that featured in their previous play with that person. From 3 years onwards, children use partner specific referential expressions (referential pacts), both with adults and peers [@matthews2010s; @koymen2014young]. Interestingly, speaker identity influences children’s interpretation of ambiguous utterances at an early point in language processing [@khu2019preschoolers; @san2015new]. However, these social inferences based on the identity of the conversational partners have rarely been studied in conjunction with discourse inferences. Thus, it is unclear whether discourse inferences involve social reasoning at all.

In the present set of studies, we investigated the impact of partner specific discourse topics on ambiguous pronoun resolution in 2- to 5-year-old children. First, we examine how children interpret ambiguous utterances in light of an overarching topic that guides conversation, but was never explicitly mentioned (and must be inferred in context). Second, we examine how their interpretation changes depending on the common ground shared with specific partners. In this way, we fill the gap between discourse and partner-specific reasoning.

In Study 1, children interacted with a speaker who repeatedly mentioned objects from a particular category (e.g., horse and dog from the category animals). At a later time in the discourse the speaker used the ambiguous pronoun it in the context of three new objects - one object from the category mentioned earlier (e.g., a cat) and two other objects (e.g., a hat and a train). We found that children from age 3 onwards reliably interpret the ambiguous pronoun as referring to the object from the same category.

In study 2 we tested whether these judgments were specific to particular speakers. Children heard one speaker talk about objects from a particular category. Then, either the same or a different speaker used the ambiguous pronoun. We found that children adjusted their inference to the identity of the speaker from age 4 onwards.

# Study 1

All experimental procedures, sample sizes and statistical analysis were pre-registered (see https://osf.io/9ypxn and https://osf.io/fyaxq). All deviations from the pre-registration are explicitly mentioned. The experimental material can be found in the associated online repository at https://github.com/manuelbohn/disCon.

## Methods

### Participants
```{r participants-ex1, include = F}
desc_ex1 <- ex1_data%>%
  mutate(sex = ifelse(sex == "F",1,0))%>%
  group_by(age_group)%>%
  summarise(n = length(unique(id)), 
            age = mean(age_num), 
            min_age = min(age_num),
            max_age = max(age_num), 
            sex = sum(sex, na.rm = T)/4)
```

Our final sample included data from 71 children, including `r desc_ex1%>%filter(age_group == "2")%>%pull(n)` 2-year-olds (*M* = `r desc_ex1%>%filter(age_group == "2")%>%pull(age)`, *range* = `r desc_ex1%>%filter(age_group == "2")%>%pull(min_age)` - `r desc_ex1%>%filter(age_group == "2")%>%pull(max_age)`, `r desc_ex1%>%filter(age_group == "2")%>%pull(sex)` girls), `r desc_ex1%>%filter(age_group == "3")%>%pull(n)` 3-year-olds (*M* = `r desc_ex1%>%filter(age_group == "3")%>%pull(age)`, *range* = `r desc_ex1%>%filter(age_group == "3")%>%pull(min_age)` - `r desc_ex1%>%filter(age_group == "3")%>%pull(max_age)`, `r desc_ex1%>%filter(age_group == "3")%>%pull(sex)` girls) and `r desc_ex1%>%filter(age_group == "4")%>%pull(n)` 4-year-olds (*M* = `r desc_ex1%>%filter(age_group == "4")%>%pull(age)`, *range* = `r desc_ex1%>%filter(age_group == "4")%>%pull(min_age)` - `r desc_ex1%>%filter(age_group == "4")%>%pull(max_age)`, `r desc_ex1%>%filter(age_group == "4")%>%pull(sex)` girls). 
We tested a larger sample of 2-year-olds because we expected a weaker effect in this age group. In addition, 28 children were recruited but not included because they were reported to have less than 75% of English exposure at home (12 children); did not finish the task (10 children); were correct on less than 5/6 training rounds (3 children, see below), or equipment failed (3 children). All children were recruited from the floor of a Children’s museum in San José, California, USA. The population from which this sample is drawn is characterized by diverse ethnic background (predominantly White, Asian, or mixed ethnicity) and high levels of parental education and socioeconomic status. Parents consented to their children’s participation and provided demographic information. Data was collected between January and September 2019. All experiments were approved by the Stanford Institutional Review Board (protocol no. 19960).

```{r fig1, include = T, fig.align = "center", fig.cap = "Left: Screenshot from the experimental setup. Right: Stimuli pictures for the four categories: fruits, vehicles, clothes and mammals.", out.width="450px"}
knitr::include_graphics("../figures/Figure1.png")
```

### Materials

Study materials were presented as a picture book on a tablet computer [@frank2016using]. Children responded by touching objects on the screen. Responses were automatically saved. We selected four categories of objects: animals, vehicles, clothes, and fruits. For each category, we chose pictures for seven different objects from that category (e.g. for vehicles: car, truck, train, bus, airplane, boat and motorbike). The right panel of figure 1 shows all pictures used in the study grouped by category (see supplementary material for a list of the corresponding words). All utterances made by the different speaker animals were pre-recorded from native English speakers, with one speaker per animal.      

### Procedure

The experimenter introduced the study as a visit to the house of the little animals, during which the animals would show the child the things they have at home. On each trial, children saw one animal (the speaker) in the middle of the screen with three objects above them (Figure 1, left). Each of the objects belonged to a different category.  Trials started with six training rounds, in which the speaker named one of the three objects displayed above them and asked the child to touch it (“Look at that, can you touch the X?”). From one round to the next, the pictures changed but the three categories remained the same and the speaker consistently asked the child to touch the object from one category. For example, on the first training round, children saw a skirt, a horse, and a motorcycle and the speaker asked “Can you touch the motorcycle?” On the second training round, children saw a jacket, a dog, and a bus and the speaker asked “Can you touch the bus?”  After the six training rounds, children moved to the test and saw a new set of three (e.g. a hat, a cat and a train). However, instead of using a label, the speaker used an ambiguous pronoun to refer to one of the objects (“Look at that, can you touch it”). Children could identify the referent of the pronoun by assuming that the speaker continues to talk about objects from the same category as they did previously (vehicles in the example above). However, in order to do so, children had to infer the category by which all of the previous objects the speaker mentioned were grouped.

Children received four sets of trials (six training trials and one test trial) with a different category as the target on each one. The categories, the order of the objects within each category and the position of the target object (left, right, middle) were randomized across children. 

## Results 
```{r experiment1, cache = T, include = F}

## comparison to chance

bf_t_age <- ex1_data %>%
  group_by(age_group, id) %>%
  summarise(correct = mean(correct)) %>%
  summarise(correct = list(correct)) %>%
  group_by(age_group)%>%
  mutate(mean= mean(unlist(correct)),
         bf = extractBF(ttestBF(unlist(correct), mu = 1/3))$bf)

## mixed model to look at age continously

ex1_model_data <- ex1_data%>%
  mutate(age_num = age_num - mean(age_num))

# ex1_m1 <- brm(correct ~ age_num + (1|id) + (age_num|target_category),
#                     data = ex1_model_data, family = bernoulli(),
#           control = list(adapt_delta = 0.999, stepsize = 0.001, max_treedepth = 40),
#           sample_prior = F,
#           chains = 4,
#           cores = 4,
#           save_all_pars = F,
#           iter = 5000)%>%
#   add_criterion("waic")%>%
#   saveRDS(., "../saves/ex1_model1.rds")
# 
# ex1_m2 <- brm(correct ~ 1 + (1|id) + (age_num|target_category),
#                     data = ex1_model_data, family = bernoulli(),
#           control = list(adapt_delta = 0.999, stepsize = 0.001, max_treedepth = 40),
#           sample_prior = F,
#           chains = 4,
#           cores = 4,
#           save_all_pars = F,
#           iter = 5000)%>%
#   add_criterion("waic")%>%
#   saveRDS(., "../saves/ex1_model2.rds")

ex1_m1 <-readRDS("../saves/ex1_model1.rds")

ex1_m2 <-readRDS("../saves/ex1_model2.rds")

t1 <- loo_compare(ex1_m1, ex1_m2, criterion = "waic")%>%
  as.data.frame() %>%
  tibble::rownames_to_column("Predictors")%>%
  mutate(
    Predictors = recode(Predictors, ex1_m1 = "Age", 
                   ex1_m2 = "Intercept only"),
    weight = exp(elpd_waic) / sum(exp(elpd_waic)),
    weight = round(weight, 3),
    WAIC = round(waic, 2),
    #BF = c("-",round(bf_ex1$bf,2)),
    SE = round(se_waic,2))%>%
  select(Predictors, WAIC, SE, weight)
``` 

```{r plots1, include = F}
pex1_1 <- ex1_data %>%
  group_by(experiment,age_group,age_num, id) %>%
  summarise(correct = mean(correct)) 

pex1_2 <- pex1_1 %>%
  group_by(experiment,age_group) %>%
  multi_boot_standard(col = "correct")

samples1 <- posterior_samples(ex1_m1, "^b")%>%
  mutate(sample = 1:length(b_age_num))

samples <- expand_grid(samples1,ex1_model_data$age_num)%>%
  mutate(y = plogis(b_Intercept + b_age_num * `ex1_model_data$age_num`),
         age = `ex1_model_data$age_num` + mean(ex1_data$age_num),
         experiment = "simple_inference")%>%
  filter(sample < 1000)

map_model <- tibble(
  age = ex1_model_data$age_num,
  int = fixef(ex1_m1)[1,1],
  slope = fixef(ex1_m1)[2,1]
)%>%
  mutate(y = plogis(int + slope * age),
         age = age + mean(ex1_data$age_num))

p1 <- ggplot() +
  geom_hline(yintercept = 1/3, lty=2, size = 1)+
  geom_jitter(data = pex1_1,aes(x = age_num, y= correct), width = .00, height = .01, alpha = .5)+
  geom_line(data = samples, aes(x = age, y = y, group = sample), size = .025, col = "grey")+
  geom_line(data = map_model, aes(x = age, y = y), size = 1)+
  geom_pointrange(data = pex1_2, aes(x = age_group+.5, y = mean, ymin = ci_lower, ymax = ci_upper, col = experiment),size = .8, position = position_dodge(width = .2), pch = 4)+
  #geom_smooth(data = ex1_data,aes(x = age_num, y= correct, col = experiment), method = "glm", method.args = list(family = "binomial"), se = T, alpha = .5, size = 1.5)+
  labs(x="Age",y="Proportion correct")+
  theme_few() +
  ylim(-0.05,1.05)+
  xlim(2,5)+
  guides(alpha = F, col = F)+
  scale_color_manual(values = "#CC6677")



# density plot
plot_post <- ex1_data %>%
  group_by(age_group,id) %>%
  summarise(correct = mean(correct))%>%
  summarise(correct = list(correct)) %>%
  group_by(age_group) %>%
  mutate(posterior = list((ttestBF(unlist(correct), mu = 1/3, posterior = T, iterations = 2000)[,"mu"])))%>%
  select(-correct)


plot_dens_ci <- plot_post %>%
  summarise(mode = estimate_mode(unlist(posterior)),
            lci = hdi_lower(unlist(posterior)),
            uci = hdi_upper(unlist(posterior)))



plot_dens <- tibble(
  age = rep(c(2,3,4), each = 2000),
  posterior = c(unlist(plot_post%>%filter(age_group == "2") %>% pull(posterior)),unlist(plot_post%>%filter(age_group == "3") %>% pull(posterior)),unlist(plot_post%>%filter(age_group == "4") %>% pull(posterior)))
)

densities <- plot_dens %>%
  group_by(age) %>%
  do(., dens = density(.$posterior))

densities_df <-
  tibble(
    age = c(rep('2', 512),
            rep('3', 512),
              rep('4', 512)),
    x = c(densities$dens[[1]]$x, 
          densities$dens[[2]]$x,
          densities$dens[[3]]$x),
    y = c(densities$dens[[1]]$y,
          densities$dens[[2]]$y,
          densities$dens[[3]]$y)
  ) %>%
  group_by(age)%>%
  mutate (
    ci_shade = ifelse( age == "3",
                       ifelse( x <= plot_dens_ci%>%filter(age_group == "3")%>%pull(lci) | x >= plot_dens_ci%>%filter(age_group == "3")%>%pull(uci), "OFF", "ON"),
                       ifelse(age == "2", ifelse( x <= plot_dens_ci%>%filter(age_group == "2")%>%pull(lci) | x >= plot_dens_ci%>%filter(age_group == "2")%>%pull(uci), "OFF", "ON"),
      ifelse( x <= plot_dens_ci%>%filter(age_group == "4")%>%pull(lci) | x >= plot_dens_ci%>%filter(age_group == "4")%>%pull(uci), "OFF", "ON"))))


post_plot <- ggplot(plot_dens, aes(y = factor(-age), x = posterior, fill = factor(stat(quantile))))+
  stat_density_ridges(
    geom = "density_ridges_gradient",
    calc_ecdf = TRUE,
    quantiles = c(0.025, 0.975)
  ) +
    labs(y="Age group", x="Proportion correct")+
  geom_vline(xintercept = 1/3, col = "black", lty = 2)+
  scale_fill_manual(values = c("#FF0000A0", "#A0A0A0A0", "#FF0000A0"))+
  guides(fill = F)+
  theme_few()+ 
  scale_y_discrete(labels=c("-2" = "2", "-3" = "3",
                              "-4" = "4"))

p2 <- ggarrange(post_plot,p1, nrow = 1, labels = c("A","B"))

```

The dependent variable in all analyses was whether the object chosen at test was from the same category as the objects named throughout the training trials. All analyses were computed in R R [@R-base]. As a first step, we aggregated responses across test trials for each child and compared the proportion of correct responses to a level expected by chance (33% correct) within each age bin. We used the function `ttestBF` from the R-package `BayesFactor` [@R-BayesFactor] to compute a Bayes factor (BF) in favor of the hypothesis that performance is above chance (0.33 correct). Figure \ref{fig:fig2}A shows the corresponding posterior distribution for each age bin. We found little evidence that 2-year olds performed above chance (mean proportion correct = `r bf_t_age%>%filter(age_group == "2")%>%pull(mean)`, BF~10~ = `r bf_t_age%>%filter(age_group == "2")%>%pull(bf)`) but found substantial evidence for 3-year-olds (mean proportion correct = `r bf_t_age%>%filter(age_group == "3")%>%pull(mean)`, BF~10~ = `r bf_t_age%>%filter(age_group == "3")%>%pull(bf)`) and 4-year-olds (mean proportion correct = `r bf_t_age%>%filter(age_group == "4")%>%pull(mean)`, BF~10~ = `r bf_t_age%>%filter(age_group == "4")%>%pull(bf)`). This result is robust to changes in the prior on the standardized effect size (see supplementary material for details).

To analyze responses continuously across age we used logistic Bayesian generalized linear mixed models (GLMM) fit via the function `brm` from the R-package `brms` [@R-brms_a]. All models had default priors and included random effects for participant and category\footnote{In the first preregistration (data collection with 3 and 4 year olds) we forgot to include random effects for category. All subsequent preregistration included it.}, with random slopes for age. Inference was based on comparing models that differed in whether they included the key predictor of interest, which was age in study 1. Following McElreath [-@rethinking], we compared models using WAIC (widely applicable information criterion) scores and weights. The WAIC score is an indicator of the model’s predictive accuracy for out of sample data; model’s with lower scores are preferred. WAIC weights are an estimate of the probability that this model (compared to all other models considered) will make the best predictions on new data. In addition, we inspected the posterior distribution for the key parameters in the model via it’s mean and 95 % credible interval (CI).  

The model comparison favored the model including age as a predictor (Table \ref{tab:table1}). The mean model estimate for age was positive ($\beta$ = `r fixef(ex1_m1)[2,1]`, 95% CI = `r fixef(ex1_m1)[2,3]` - `r fixef(ex1_m1)[2,4]`), suggesting an increase of performance with age (see Figure \ref{fig:fig2}B). However, the small difference in model weights and the fact that the 95% CI for the model estimate also overlapped with zero speak against substantial developmental gains in the age range considered. 
  
```{r fig2, include = T, fig.align = "center", fig.cap = "(A) Posterior probability distribution for the mean for each age bin based on one sample Bayesian t-test. Grey regions indicate 95\\% credible intervals for each age group. (B) Correct responses for age continuously. Transparent dots show data aggregated for each individual participant. Red crosses show mean within age bin with 95\\% confidence intervals based on non-parametric bootstrap of the data. Black line shows the mean of the posterior distribution of the model including age. Grey lines show 1000 random draws from the model posterior to depict uncertainty in the model. Dotted line indicates a level of performance expected by chance.", fig.width=10, fig.height=4, fig.fullwidth = TRUE}
p2
```

```{r}
#ggsave("../figures/Figure2.png", width = 8, height = 3, scale = 1.2)
```

```{r table1,results = "asis"}
apa_table(
  t1
  , caption = "Model comparison for Experiment 1"
  , note = "All models included random intercepts for participant and category and random slopes for age within category."
  , escape = T
)
```

## Discussion
This study presents evidence consistent with the idea that starting around age 3, children make inferences about conversational topics. Based on hearing a speaker consistently refer to objects from a certain category, children interpreted the ambiguous pronoun it as referring to another object of the same category. This suggests that children track common ground with a speaker not just in terms of remembering what has been talked about previously, but also in the form of an overarching topic that guides the conversation and allows predictions about what will be talked about in the future.

In a follow-up, we tested whether the number of training trials affected children’s ability to make the inference. We contrasted one training trial with six training trials. The results suggest that fewer training trials do not necessarily mean worse performance. However, the data were not conclusive and we therefore present the procedure and the analyses of this study in the supplementary material.

We also conducted an exploratory analysis (not pre-registered) to investigate whether the inference varied with the category that had to be inferred. Results point to differences between categories in that, for example, children were more likely to be correct when fruit is the target category compared to clothes. Details of this analysis are presented in the supplementary material. We return to this point in the general discussion. In the next study, we continued with the same number of training trials and categories and focused on whether the inference found in Study 1 is partner specific.


# Study 2

Children carried out the same task as in Study 1. However, in half of the trials it was the same speaker who produced the ambiguous pronoun (“Can you touch it?”) as the speaker who presented the training trials and in the other half of the critical trials, it was a new speaker. Because we found limited evidence that 2-year-olds make category-based discourse inferences in study 1, we only tested 3- and 4-year-olds in study 2. The preregistration for this study can be found at https://osf.io/5e9pk and the study materials are in the associated online repository.

## Methods

### Participants
```{r participants-ex2, include = F}
desc_ex2 <- ex2_data%>%
  mutate(sex = ifelse(sex == "F",1,0))%>%
  group_by(age_group)%>%
  summarise(n = length(unique(id)), 
            age = mean(age_num), 
            min_age = min(age_num),
            max_age = max(age_num),
            sex = sum(sex)/4)
```

Sixty children, including `r desc_ex2%>%filter(age_group == "3")%>%pull(n)` 3-year-olds (*M* = `r desc_ex2%>%filter(age_group == "3")%>%pull(age)`, *range* = `r desc_ex2%>%filter(age_group == "3")%>%pull(min_age)` - `r desc_ex2%>%filter(age_group == "3")%>%pull(max_age)`, `r desc_ex2%>%filter(age_group == "3")%>%pull(sex)` girls) and `r desc_ex2%>%filter(age_group == "4")%>%pull(n)` 4-year-olds (*M* = `r desc_ex2%>%filter(age_group == "4")%>%pull(age)`, *range* = `r desc_ex2%>%filter(age_group == "4")%>%pull(min_age)` - `r desc_ex2%>%filter(age_group == "4")%>%pull(max_age)`, `r desc_ex2%>%filter(age_group == "4")%>%pull(sex)` girls) participated in this study. In addition, eight children were tested but not included because they had less than 75% English exposure at home (4 children); they did not finish the task (2 children), or the equipment failed (2 children). Data was collected in August and September of 2019. For details on population characteristics and ethical approval see Study 1.

### Materials

Study materials were the same as in Study 1.

## Procedure

The general procedure was the same as in Study 1 except for the following changes. The speakers were introduced as showing children their *favorite* things (study 1: things they have at home). We included this to focus children’s attention on the individual speakers. Conversely, when making a request, speakers said: “I like that. Can you touch [object/it]”. The speaker change manipulation was implemented in the following way: After the six training trials, the speaker announced that they had to leave and left the scene by walking off the left edge of the screen. After a short pause, either the same or a different animal returned to the scene, positioned themselves in the middle, and made a request using the ambiguous pronoun. If the same speaker returned, they entered from the same side as they left; if a new speaker appeared, they entered from the other side. This measure served to emphasize that the different speaker was new to the scene and therefore unfamiliar with the preceding discourse. If the speaker was the same as during the training trials, children could infer the referent of the pronoun in the same way as in Study 1. However, if the speaker changed, no such inference was licenced if children assumed that the discourse topic is specific to a speaker.

Selection and positioning of objects and categories was randomized in the same way as in Study 1. Each child received four test trials, two with the same and two with a different speaker returning, in an order randomized for each child.


## Results

```{r experiment2, cache = T, include = F}
ex2_model_data <- ex2_data%>%
  mutate(age_num = age_num - mean(age_num))

# ex2_m1 <- brm(correct ~ age_num * condition + (condition|id) + (age_num + condition|target_category),
#                     data = ex2_model_data, family = bernoulli(),
#           control = list(adapt_delta = 0.999, stepsize = 0.0001, max_treedepth = 50),
#           sample_prior = F,
#           chains = 4,
#           cores = 4,
#           save_all_pars = F,
#           iter = 5000)%>%
#    add_criterion("waic")%>%
#   saveRDS(., "../saves/ex2_model1.rds")
# 
# ex2_m2 <- brm(correct ~ age_num + condition + (condition|id) + (age_num + condition|target_category),
#                     data = ex2_model_data, family = bernoulli(),
#           control = list(adapt_delta = 0.999, stepsize = 0.0001, max_treedepth = 50),
#           sample_prior = F,
#           chains = 4,
#           cores = 4,
#           save_all_pars = F,
#           iter = 5000)%>%
#    add_criterion("waic")%>%
#   saveRDS(., "../saves/ex2_model2.rds")
# 
# ex2_m3 <- brm(correct ~ age_num + (condition|id) + (age_num + condition|target_category),
#                     data = ex2_model_data, family = bernoulli(),
#           control = list(adapt_delta = 0.999, stepsize = 0.0001, max_treedepth = 50),
#           sample_prior = F,
#           chains = 4,
#           cores = 4,
#           save_all_pars = F,
#           iter = 5000)%>%
#    add_criterion("waic")%>%
#   saveRDS(., "../saves/ex2_model3.rds")

ex2_m1 <-readRDS("../saves/ex2_model1.rds")

ex2_m2 <-readRDS("../saves/ex2_model2.rds")

ex2_m3 <-readRDS("../saves/ex2_model3.rds")

t2 <- loo_compare(ex2_m1, ex2_m2, ex2_m3, criterion = "waic")%>%
  as.data.frame() %>%
  tibble::rownames_to_column("Predictors")%>%
  mutate(
    Predictors = recode(Predictors, ex2_m1 = "Age * Condition", 
                   ex2_m2 = "Age + Condition",
                   ex2_m3 = "Age"),
    weight = exp(elpd_waic) / sum(exp(elpd_waic)),
    weight = round(weight, 2),
    WAIC = round(waic, 2),
    SE = round(se_waic,2))%>%
  select(Predictors, WAIC, SE, weight)


```



```{r table2,results = "asis"}
apa_table(
  t2
  , caption = "Model comparison for Experiment 2"
  , note = "All models included random intercepts for participant and speaker and random slopes for condition within participant and within condition and age within category."
  , escape = T
)
```

```{r plots2}
pex2_1 <- ex2_data %>%
  group_by(condition,age_group,age_num, id) %>%
  summarise(correct = mean(correct)) 

pex2_2 <- pex2_1 %>%
  group_by(condition,age_group) %>%
  multi_boot_standard(col = "correct")


samples2 <- posterior_samples(ex2_m1, "^b")%>%
  mutate(sample = 1:length(b_age_num))

sample2 <- expand_grid(samples2,ex2_model_data$age_num)%>%
  filter(sample < 2000)%>%
  mutate(condition = ifelse(sample <1000, "same_speaker", "different_speaker"),
         y = ifelse(condition == "different_speaker", plogis(b_Intercept + b_age_num * `ex2_model_data$age_num`), plogis(b_Intercept + b_conditionsame_speaker + b_age_num * `ex2_model_data$age_num` + `b_age_num:conditionsame_speaker` * `ex2_model_data$age_num`)),
         age = `ex2_model_data$age_num` + mean(ex2_data$age_num))


map_model_2 <- tibble(
  age = rep(ex2_model_data$age_num, 2),
  condition = c(rep("same_speaker", length(ex2_model_data$age_num)),rep("different_speaker", length(ex2_model_data$age_num))),
  int = fixef(ex2_m1)[1,1],
  slope = fixef(ex2_m1)[2,1],
  speak = fixef(ex2_m1)[3,1],
  int_act = fixef(ex2_m1)[4,1]
)%>%
  mutate(y = ifelse(condition == "different_speaker", plogis(int + slope * age), plogis(int + speak + slope * age + int_act * age)),
         age = age + mean(ex2_data$age_num))


p3 <- ggplot() +
  geom_hline(yintercept = 1/3, lty=2, size = 1)+
  geom_jitter(data = pex2_1,aes(x = age_num, y= correct, col = condition), width = .00, height = .01, alpha = .5)+
  geom_line(data = sample2, aes(x = age, y = y, col = condition, group = sample), size = .025)+
  geom_line(data = map_model_2, aes(x = age, y = y, col = condition), size = 1)+
  geom_pointrange(data = pex2_2, aes(x = age_group+.5, y = mean, ymin = ci_lower, ymax = ci_upper, col = condition),size = .8, position = position_dodge(width = .2), pch = 4)+
  labs(x="Age",y="Proportion correct")+
  theme_few() +
  ylim(-0.05,1.05)+
  xlim(3,5)+
  guides(alpha = F)+
  scale_color_ptol(name = "Speaker",
                   breaks = c("different_speaker", "same_speaker"),
                   labels = c("Different", "Same"))
```

```{r fig3, include = T, fig.align = "center", fig.cap = "Correct responses in study 2 by age and condition. Transparent dots show aggregated data from individual participants. Blue and red crosses show data mean for by-year age bins with 95\\% confidence interval based on non-parametric bootstrap. Colored lines show the mean of the posterior distribution for each condition based on the interaction model. Lighter lines show 1000 random draws per condition from the model posterior to depict uncertainty. Dotted line indicates a level of performance expected by chance.", fig.width=6, fig.height=4, out.width = '60%'}
p3
```

```{r}
ggsave("../figures/Figure3.png", width = 4, height = 3, scale = 1.5)
```

We tested the effect of speaker change on children’s discourse inferences via a model comparison. We compared a base model including only age as a fixed effect to models including speaker type, either as a main effect or as an interaction with age. Models were fitted and compared in the same way as in Study 1. Models now also included random slopes for condition. The model comparison clearly favored the interaction model (Table \ref{tab:table2}). The interaction model was three times more likely than the other models considered to make better predictions on new data. The interaction term in the model itself was large and reliably different from zero  ($\beta$ = `r fixef(ex2_m1)[4,1]`, 95% CI = `r fixef(ex2_m1)[4,3]` - `r fixef(ex2_m1)[4,4]`). Figure \ref{fig:fig3} visualizes the data and the interaction model and shows that while younger children did not take into account speaker identity, older children (starting at around age 4) only interpreted the ambiguous pronoun in light of the previous discourse topic when the speaker remained the same.

## Discussion 

In study 2, we found evidence that children from 4 years onward assume that a conversational topic is specific to the identity of the speaker. When one speaker repeatedly referred to objects from the same category, they expected the same speaker, but not a different one, to continue communicating about the same category. 3-year-olds, on the other hand, did not take into account speaker identity. 

# General Discussion

We studied how children use conversational topics with specific partners to interpret ambiguous pronouns. Our results suggest that by age 3, children infer the topic of a conversation based on preceding discourse in order to identify the referent of an ambiguous pronoun. Moreover, starting at age 4, children also associated this inference with specific partners. These findings illustrate how children can leverage the structure of the social interactions in which conversations take place to disambiguate utterances.

We did not find substantial evidence that children under the age of 3 are able to make the inference in Study 1. However, we suspect that this result is not due to younger children lacking the necessary inferential abilities but due to difficulties with processing the information the inference was based on. In an exploratory analysis we compared children’s performance in the different categories. We found that children across the age range were more likely to make the inference when fruit was the target category compared to when it was clothes. Animals and vehicles resulted in intermediate levels of performance (details for this analysis are reported in the supplementary material). On the one hand, younger children might not conceptualize e.g. clothes as a cohesive category. On the other hand, the individual objects in some categories might be less familiar to children and provide limited evidence for the category itself. From a developmental perspective, this pattern suggests that the main loci of change are children’s vocabulary and conceptual abilities. Of course, the exploratory nature of these results needs confirmation in future studies.

Study 2 showed more pronounced developmental effects. While 3-year-olds tended to choose the object from the same category for both speakers (see Figure \ref{fig:fig3}), 4-year-olds only did so when the speaker was the same. The lack of sensitivity to speaker identity seems to conflict with earlier work which found speaker-specific communicative adjustment in younger children [@bohn2018social; @saylor2007infants]. However, in these studies, speakers only communicated about objects that were communicated about before. Children could identify the referent by remembering which speaker had communicated about which object. In our study, the objects at test had never been communicated about before. The connection to the prior discourse only lay in the relation of the objects to the topic under discussion. Thus, children not only needed to track what objects had been talked about but also had to infer that talking about these objects is a product of the particular speaker intending to talk about a specific topic. 

Our setup provides an interesting and novel way to study the interplay between linguistic knowledge (necessary to make inferences about categories), conceptual knowledge (necessary to make inferences about additional category members) and social cognition (necessary to determine whether inferences are licensed). This interplay opens up questions about the processes involved in balancing and integrating these different information sources. Computational models provide a productive way to formalise theories of how information may be integrated. For example, Bohn and colleagues [-@bohn_tessler_merrick_frank_2019] used a Bayesian model of pragmatic reasoning [@frank2012predicting] to formalise and predict the process by which children integrate information from common ground with information that is provided by an utterance in the moment.  

An open question is how these results generalize outside the scope of the present context with data collected using tablet computers in a western, affluent study population. Regarding the first point, Frank and colleagues [-@frank2016using] found similar results when children were tested in a communication task either on a tablet or in a live interaction. Regarding the second point, there are relatively few cross-cultural developmental studies on pragmatic inference, with some finding similar [@zhao_ren_frank_zhou_2019] and others different [@fortier_kellier_flecha_frank_2018] trajectories compared to western, affluent settings.

Taken together, the studies reported here illustrate the development of children’s ability to balance different layers of discourse. Thinking of discourse as organized by overarching topics allows listeners to predict what will be talked about next and, assuming that these predictions hold, increases the likelihood of successful comprehension. But discourse is also a form of social interaction and thus requires making inferences about the common ground shared between specific conversational partners. Here we show that children can use these processes to identify the referent of an ambiguous utterance. Because referent identification is a first step in language learning, we expect the same processes to also be recruited for language learning. 


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
